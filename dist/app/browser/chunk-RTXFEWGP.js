import{a as h}from"./chunk-4522AEMD.js";import{L as v,P as l,bc as E,sa as u}from"./chunk-UMI3KQKL.js";var m=class g{constructor(t,e){this.cookieService=e;this.isBrowser=E(t)}STORAGE_KEY_VIDEO="analytics_video_events";STORAGE_KEY_CONTENT="analytics_content_views";STORAGE_KEY_SEARCH="analytics_search_events";MAX_EVENTS_STORED=1e3;isBrowser;videoTrackingData=new Map;isTrackingEnabled(){return this.isBrowser?this.cookieService.isCategoryEnabled("analytics"):!1}trackVideoPlay(t,e,r,n){if(!this.isTrackingEnabled())return;let i=`${r||e}_${t}`,a=this.videoTrackingData.get(i)||{totalPlayTime:0,maxPercentage:0};a.startTime=Date.now(),a.lastPauseTime=void 0,this.videoTrackingData.set(i,a)}trackVideoPause(t,e,r,n,i,a){if(!this.isTrackingEnabled())return;let s=`${i||e}_${t}`,o=this.videoTrackingData.get(s);if(o?.startTime){let T=Date.now()-o.startTime;o.totalPlayTime+=T,o.lastPauseTime=Date.now()}let c=n>0?r/n*100:0,d=Math.max(o?.maxPercentage||0,c),p={eventType:"pause",signLanguageType:t,videoTitle:e,contentId:i,contentType:a,timestamp:Date.now(),currentTime:r,duration:n,percentageWatched:c};this.saveVideoEvent(p),o&&(o.maxPercentage=d,this.videoTrackingData.set(s,o))}trackVideoCompleted(t,e,r,n,i){if(!this.isTrackingEnabled())return;let a=`${n||e}_${t}`,s=this.videoTrackingData.get(a);if(s?.startTime){let c=Date.now()-s.startTime;s.totalPlayTime+=c}let o={eventType:"completed",signLanguageType:t,videoTitle:e,contentId:n,contentType:i,timestamp:Date.now(),currentTime:r,duration:r,percentageWatched:100};this.saveVideoEvent(o),this.videoTrackingData.delete(a)}trackVideoTimeUpdate(t,e,r,n,i,a){if(!this.isTrackingEnabled())return;let s=`${i||e}_${t}`,o=this.videoTrackingData.get(s)||{totalPlayTime:0,maxPercentage:0},c=n>0?r/n*100:0;o.maxPercentage=Math.max(o.maxPercentage,c),this.videoTrackingData.set(s,o)}trackContentView(t,e,r=[]){if(!this.isTrackingEnabled())return;let n={contentId:t,contentType:e,hashtags:r,timestamp:Date.now()};this.saveContentViewEvent(n)}trackSearch(t,e,r){if(!this.isTrackingEnabled())return;let n={query:t,filters:r,resultsCount:e,timestamp:Date.now()};this.saveSearchEvent(n)}saveVideoEvent(t){if(this.isBrowser)try{let e=localStorage.getItem(this.STORAGE_KEY_VIDEO),r=e?JSON.parse(e):[];r.push(t),r.length>this.MAX_EVENTS_STORED&&r.shift(),localStorage.setItem(this.STORAGE_KEY_VIDEO,JSON.stringify(r))}catch(e){console.error("Error al guardar evento de v\xEDdeo:",e)}}saveContentViewEvent(t){if(this.isBrowser)try{let e=localStorage.getItem(this.STORAGE_KEY_CONTENT),r=e?JSON.parse(e):[];r.push(t),r.length>this.MAX_EVENTS_STORED&&r.shift(),localStorage.setItem(this.STORAGE_KEY_CONTENT,JSON.stringify(r))}catch(e){console.error("Error al guardar evento de vista de contenido:",e)}}saveSearchEvent(t){if(this.isBrowser)try{let e=localStorage.getItem(this.STORAGE_KEY_SEARCH),r=e?JSON.parse(e):[];r.push(t),r.length>this.MAX_EVENTS_STORED&&r.shift(),localStorage.setItem(this.STORAGE_KEY_SEARCH,JSON.stringify(r))}catch(e){console.error("Error al guardar evento de b\xFAsqueda:",e)}}getVideoEvents(){if(!this.isBrowser)return[];try{let t=localStorage.getItem(this.STORAGE_KEY_VIDEO);return t?JSON.parse(t):[]}catch(t){return console.error("Error al obtener eventos de v\xEDdeo:",t),[]}}getContentViewEvents(){if(!this.isBrowser)return[];try{let t=localStorage.getItem(this.STORAGE_KEY_CONTENT);return t?JSON.parse(t):[]}catch(t){return console.error("Error al obtener eventos de vista de contenido:",t),[]}}getSearchEvents(){if(!this.isBrowser)return[];try{let t=localStorage.getItem(this.STORAGE_KEY_SEARCH);return t?JSON.parse(t):[]}catch(t){return console.error("Error al obtener eventos de b\xFAsqueda:",t),[]}}getVideoLanguageStats(){let t=this.getVideoEvents(),e={lse:0,lsc:0,total:t.length};return t.forEach(r=>{r.signLanguageType==="lse"?e.lse++:r.signLanguageType==="lsc"&&e.lsc++}),e}getContentViewStatsByCategory(){let t=this.getContentViewEvents(),e={};return t.forEach(r=>{e[r.contentType]=(e[r.contentType]||0)+1}),e}getContentViewStatsByHashtag(){let t=this.getContentViewEvents(),e={};return t.forEach(r=>{r.hashtags.forEach(n=>{e[n]=(e[n]||0)+1})}),e}calculateVideoAvailabilityStats(t){let e=t.length,r=0,n=0,i=0;return t.forEach(a=>{let s=!!a.video_lse_url,o=!!a.video_lsc_url;s&&r++,o&&n++,s&&o&&i++}),{total:e,withLSE:r,withLSC:n,withBoth:i,percentageLSE:e>0?r/e*100:0,percentageLSC:e>0?n/e*100:0,percentageBoth:e>0?i/e*100:0}}getMostFrequentSearches(t=10){let e=this.getSearchEvents(),r={};return e.forEach(n=>{n.query.trim()&&(r[n.query]=(r[n.query]||0)+1)}),Object.entries(r).map(([n,i])=>({query:n,count:i})).sort((n,i)=>i.count-n.count).slice(0,t)}getGeneralStats(){let t=this.getVideoEvents(),e=this.getContentViewEvents(),r=this.getSearchEvents();return{totalVideoEvents:t.length,totalContentViews:e.length,totalSearches:r.length,videoPlayCount:t.filter(n=>n.eventType==="play").length,videoPauseCount:t.filter(n=>n.eventType==="pause").length,videoCompletedCount:t.filter(n=>n.eventType==="completed").length}}clearAllEvents(){this.isBrowser&&(localStorage.removeItem(this.STORAGE_KEY_VIDEO),localStorage.removeItem(this.STORAGE_KEY_CONTENT),localStorage.removeItem(this.STORAGE_KEY_SEARCH),this.videoTrackingData.clear())}static \u0275fac=function(e){return new(e||g)(l(u),l(h))};static \u0275prov=v({token:g,factory:g.\u0275fac,providedIn:"root"})};export{m as a};
