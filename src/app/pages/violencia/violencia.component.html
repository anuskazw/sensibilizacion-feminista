<div class="violencia-page">
  <!-- Sidebar con filtros e índice de términos -->
  <app-content-sidebar
    [sectionTitle]="'header.violence'"
    [hashtags]="hashtags()"
    [showYearFilter]="false"
    [showAlphabeticalIndex]="false"
    (filtersChange)="onFiltersChange($event)">
  </app-content-sidebar>

  <!-- Contenido principal -->
  <main class="main-content" role="main">
    <div class="content-header">
      <h1>{{ 'header.violence' | translate }}</h1>
      <p class="content-description">
        Información sobre tipos de violencia, señales de alerta y recursos de ayuda.
      </p>
    </div>

    <!-- Índice de términos -->
    @if (termsIndex().length > 0) {
      <div class="terms-index">
        <h2 class="index-title">{{ 'violence.termsIndex' | translate }}</h2>
        <div class="terms-list">
          @for (term of termsIndex(); track term) {
            <button 
              type="button"
              class="term-link"
              (click)="scrollToTerm(term)"
              [attr.aria-label]="'violence.scrollToTerm' | translate: { term: term }">
              {{ term }}
            </button>
          }
        </div>
      </div>
    }

    <!-- Estados de carga y error -->
    @if (isLoading()) {
      <app-skeleton-screen
        type="list"
        [count]="4"
        [showTitle]="true"
        [showDescription]="true"
        [showHashtags]="true"
        [showButton]="false">
      </app-skeleton-screen>
    } @else if (hasError()) {
      <app-error-state
        [message]="errorMessage()"
        [showRetry]="true"
        [suggestions]="getErrorSuggestions()"
        (retry)="retryLoad()">
      </app-error-state>
    } @else {
      <!-- Resultados -->
      <div class="results-info">
        @if (filteredContents().length > 0) {
          <p class="results-count">
            {{ 'search.resultsCount' | translate: { count: filteredContents().length } }}
          </p>
        }
      </div>

      <!-- Listado de contenidos -->
      <div class="contents-list">
        @if (filteredContents().length > 0) {
        @for (content of filteredContents(); track content.id) {
          <article class="content-card" [id]="'content-' + content.id">
            <div class="card-header">
              <h2 class="card-title">{{ getTitle(content) }}</h2>
            </div>
            
            <div class="card-body">
              <p class="card-description">{{ getDescription(content) }}</p>

              <div class="card-collapsibles">
                @if (getAlertSigns(content)) {
                  <details class="alert-signs">
                    <summary class="alert-signs-summary">
                      <svg class="alert-signs-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                      </svg>
                      <span>{{ 'violence.alertSigns' | translate }}</span>
                      <svg class="alert-signs-chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <polyline points="6 9 12 15 18 9"/>
                      </svg>
                    </summary>
                    <p class="alert-signs-content">{{ getAlertSigns(content) }}</p>
                  </details>
                }

                @if (content.recursos_ayuda && content.recursos_ayuda.length > 0) {
                  <details class="card-help-resources">
                    <summary class="help-resources-summary">
                      <svg class="help-resources-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                      </svg>
                      <span>{{ 'violence.helpResources' | translate }}</span>
                      <svg class="help-resources-chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <polyline points="6 9 12 15 18 9"/>
                      </svg>
                    </summary>
                    <div class="help-resources-list">
                      @for (resource of content.recursos_ayuda; track resource) {
                        <div class="help-resource-item">
                          <strong>{{ resource }}</strong>
                          @if (resource === '016') {
                            <span class="resource-description">{{ 'violence.phone016' | translate }}</span>
                          }
                          @if (resource === '112') {
                            <span class="resource-description">{{ 'violence.phone112' | translate }}</span>
                          }
                          @if (resource === '017') {
                            <span class="resource-description">{{ 'violence.phone017' | translate }}</span>
                          }
                        </div>
                      }
                    </div>
                  </details>
                }
              </div>
            </div>

            <div class="card-footer">
              <div class="card-hashtags">
                @for (hashtag of content.hashtags; track hashtag.id) {
                  <span class="hashtag-badge">#{{ getHashtagName(hashtag) }}</span>
                }
              </div>
            </div>

            <div class="card-share">
              <app-social-share [content]="content"></app-social-share>
            </div>

            @if (content.video_lse_url) {
              <div class="card-actions">
                <button class="video-button" type="button">
                  <svg 
                    xmlns="http://www.w3.org/2000/svg" 
                    viewBox="0 0 24 24" 
                    fill="none" 
                    stroke="currentColor" 
                    stroke-width="2"
                    aria-hidden="true">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                  </svg>
                  {{ 'video.selectSignLanguage' | translate }}
                </button>
              </div>
            }
          </article>
        }
      } @else {
        <div class="no-results">
          <svg 
            xmlns="http://www.w3.org/2000/svg" 
            viewBox="0 0 24 24" 
            fill="none" 
            stroke="currentColor" 
            stroke-width="2"
            class="no-results-icon"
            aria-hidden="true">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <h2>{{ 'search.noResults' | translate }}</h2>
          <p>{{ 'violence.noResultsMessage' | translate }}</p>
        </div>
      }
      </div>
    }
  </main>
</div>

