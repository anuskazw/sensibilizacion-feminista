<div class="detalle-historia-page">
  @if (isLoading()) {
    <div class="loading-container">
      <p>Cargando...</p>
    </div>
  } @else if (notFound()) {
    <div class="not-found-container">
      <h1>Contenido no encontrado</h1>
      <p>La historia que buscas no existe o ha sido eliminada.</p>
      <a routerLink="/historia" class="back-link">Volver a Historia</a>
    </div>
  } @else if (content()) {
    <main class="main-content" role="main">
      <!-- Botón de volver -->
      <div class="back-button-container">
        <button (click)="goBack()" class="back-button" type="button">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
          Volver a Historia
        </button>
      </div>

      <!-- Encabezado del artículo -->
      <header class="article-header">
        <span class="article-year">{{ content()!.anio }}</span>
        <h1 class="article-title">{{ getTitle() }}</h1>
        <p class="article-description">{{ getDescription() }}</p>
        
        <!-- Hashtags -->
        <div class="article-hashtags">
          @for (hashtag of content()!.hashtags; track hashtag.id) {
            <span class="hashtag-badge">#{{ hashtag.nombre }}</span>
          }
        </div>
      </header>

      <!-- Video signado -->
      @if (content()!.video_lse_url || content()!.video_lsc_url) {
        <section class="video-section">
          @if (isYouTubeUrl(getVideoUrl() || undefined)) {
            <!-- Video de YouTube embebido -->
            <div class="youtube-video-container">
              <iframe
                [src]="getSafeYouTubeUrl(getVideoUrl()!)"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen
                loading="lazy"
                [attr.aria-label]="getTitle() + ' - Vídeo en YouTube'"
                class="youtube-iframe">
              </iframe>
            </div>
          } @else {
            <!-- Reproductor de video personalizado -->
            <app-sign-language-video-player
              [video]="getVideoData()!"
              [inline]="true"
              [contentId]="content()!.id"
              contentType="historia">
            </app-sign-language-video-player>
          }
        </section>
      }

      <!-- Contenido extendido del artículo -->
      <article class="article-content">
        <div class="article-body">
          <div class="article-text">
            @for (paragraph of getExtendedContentParagraphs(); track $index) {
              <p>{{ paragraph }}</p>
            }
          </div>
        </div>
      </article>

      <!-- Referencias -->
      @if (content()!.referencias && content()!.referencias!.length > 0) {
        <section class="references-section">
          <h2 class="section-title">Referencias</h2>
          <ul class="references-list">
            @for (ref of content()!.referencias!; track ref.titulo) {
              <li class="reference-item">
                @if (ref.url) {
                  <a [href]="ref.url" target="_blank" rel="noopener noreferrer" class="reference-link">
                    {{ ref.titulo }}
                  </a>
                } @else {
                  <span class="reference-text">{{ ref.titulo }}</span>
                }
                @if (ref.autor) {
                  <span class="reference-author"> - {{ ref.autor }}</span>
                }
                @if (ref.anio) {
                  <span class="reference-year"> ({{ ref.anio }})</span>
                }
              </li>
            }
          </ul>
        </section>
      }

      <!-- Compartir en redes sociales -->
      <section class="share-section">
        <h2 class="section-title">Compartir</h2>
        <app-social-share [content]="content()!" [url]="getShareUrl()"></app-social-share>
      </section>
    </main>
  }
</div>

