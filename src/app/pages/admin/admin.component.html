<div class="admin-container">
  <header class="admin-header">
    <div class="header-content">
      <h1>{{ 'admin.title' | translate }}</h1>
      <div class="header-actions">
        <span class="user-info">{{ 'admin.welcome' | translate }}, {{ authService.getCurrentUser() }}</span>
        <button type="button" class="btn-secondary" (click)="logout()">
          {{ 'admin.logout' | translate }}
        </button>
      </div>
    </div>
  </header>

  <main class="admin-main">
    <!-- Estadísticas -->
    <section class="stats-section">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value">{{ stats().total }}</div>
          <div class="stat-label">{{ 'admin.stats.total' | translate }}</div>
        </div>
        <div class="stat-card status-borrador">
          <div class="stat-value">{{ stats().borrador }}</div>
          <div class="stat-label">{{ 'admin.stats.draft' | translate }}</div>
        </div>
        <div class="stat-card status-revisado">
          <div class="stat-value">{{ stats().revisado }}</div>
          <div class="stat-label">{{ 'admin.stats.reviewed' | translate }}</div>
        </div>
        <div class="stat-card status-publicado">
          <div class="stat-value">{{ stats().publicado }}</div>
          <div class="stat-label">{{ 'admin.stats.published' | translate }}</div>
        </div>
      </div>
    </section>

    <!-- Métricas de Analytics -->
    <section class="metrics-section">
      <h2>{{ 'admin.metrics.title' | translate }}</h2>
      
      <!-- Métricas generales -->
      <div class="metrics-grid">
        <div class="metric-card">
          <h3>{{ 'admin.metrics.videoEvents' | translate }}</h3>
          <div class="metric-value">{{ analyticsStats().totalVideoEvents }}</div>
          <div class="metric-details">
            <span>{{ 'admin.metrics.plays' | translate }}: {{ analyticsStats().videoPlayCount }}</span>
            <span>{{ 'admin.metrics.pauses' | translate }}: {{ analyticsStats().videoPauseCount }}</span>
            <span>{{ 'admin.metrics.completed' | translate }}: {{ analyticsStats().videoCompletedCount }}</span>
          </div>
        </div>

        <div class="metric-card">
          <h3>{{ 'admin.metrics.contentViews' | translate }}</h3>
          <div class="metric-value">{{ analyticsStats().totalContentViews }}</div>
          <div class="metric-details">
            @for (category of getContentViewCategories(); track category) {
              <span>{{ 'admin.type.' + category | translate }}: {{ getContentViewCount(category) }}</span>
            }
          </div>
        </div>

        <div class="metric-card">
          <h3>{{ 'admin.metrics.searches' | translate }}</h3>
          <div class="metric-value">{{ analyticsStats().totalSearches }}</div>
        </div>

        <div class="metric-card">
          <h3>{{ 'admin.metrics.videoLanguages' | translate }}</h3>
          <div class="metric-details">
            <span>LSE: {{ videoLanguageStats().lse }}</span>
            <span>LSC: {{ videoLanguageStats().lsc }}</span>
            <span>{{ 'admin.metrics.total' | translate }}: {{ videoLanguageStats().total }}</span>
          </div>
        </div>
      </div>

      <!-- Disponibilidad de vídeos -->
      <div class="metrics-grid">
        <div class="metric-card">
          <h3>{{ 'admin.metrics.videoAvailability' | translate }}</h3>
          <div class="metric-details">
            <div class="availability-item">
              <span>{{ 'admin.metrics.withLSE' | translate }}:</span>
              <span class="percentage">{{ videoAvailabilityStats().percentageLSE.toFixed(1) }}%</span>
              <span>({{ videoAvailabilityStats().withLSE }}/{{ videoAvailabilityStats().total }})</span>
            </div>
            <div class="availability-item">
              <span>{{ 'admin.metrics.withLSC' | translate }}:</span>
              <span class="percentage">{{ videoAvailabilityStats().percentageLSC.toFixed(1) }}%</span>
              <span>({{ videoAvailabilityStats().withLSC }}/{{ videoAvailabilityStats().total }})</span>
            </div>
            <div class="availability-item">
              <span>{{ 'admin.metrics.withBoth' | translate }}:</span>
              <span class="percentage">{{ videoAvailabilityStats().percentageBoth.toFixed(1) }}%</span>
              <span>({{ videoAvailabilityStats().withBoth }}/{{ videoAvailabilityStats().total }})</span>
            </div>
          </div>
        </div>

        <!-- Búsquedas más frecuentes -->
        <div class="metric-card">
          <h3>{{ 'admin.metrics.mostFrequentSearches' | translate }}</h3>
          @if (mostFrequentSearches().length === 0) {
            <p class="no-data">{{ 'admin.metrics.noSearches' | translate }}</p>
          } @else {
            <ul class="search-list">
              @for (search of mostFrequentSearches(); track search.query) {
                <li>
                  <span class="search-query">{{ search.query }}</span>
                  <span class="search-count">{{ search.count }}</span>
                </li>
              }
            </ul>
          }
        </div>
      </div>
    </section>

    <!-- Filtros -->
    <section class="filters-section">
      <div class="filters-grid">
        <div class="filter-group">
          <label for="search">{{ 'admin.search' | translate }}</label>
          <input
            type="text"
            id="search"
            [(ngModel)]="searchQuery"
            [placeholder]="'admin.searchPlaceholder' | translate"
          />
        </div>

        <div class="filter-group">
          <label for="status">{{ 'admin.filter.status' | translate }}</label>
          <select id="status" [(ngModel)]="selectedStatus">
            @for (option of statusOptions; track option.value) {
              <option [value]="option.value">{{ option.label | translate }}</option>
            }
          </select>
        </div>

        <div class="filter-group">
          <label for="type">{{ 'admin.filter.type' | translate }}</label>
          <select id="type" [(ngModel)]="selectedType">
            @for (option of typeOptions; track option.value) {
              <option [value]="option.value">{{ option.label | translate }}</option>
            }
          </select>
        </div>
      </div>
    </section>

    <!-- Lista de contenidos -->
    <section class="contents-section">
      <h2>{{ 'admin.contents.title' | translate }}</h2>
      
      @if (filteredContents().length === 0) {
        <div class="empty-state">
          <p>{{ 'admin.contents.empty' | translate }}</p>
        </div>
      } @else {
        <div class="contents-list">
          @for (content of filteredContents(); track content.id) {
            <article class="content-card">
              <div class="content-header">
                <div class="content-info">
                  <h3>{{ getContentTitle(content) }}</h3>
                  <div class="content-meta">
                    <span class="content-type">{{ 'admin.type.' + content.tipo | translate }}</span>
                    <span class="content-date">{{ 'admin.created' | translate }}: {{ formatDate(content.fecha_creacion) }}</span>
                  </div>
                </div>
                <div class="content-status">
                  <span [class]="'status-badge ' + getStatusClass(content.estado)">
                    {{ getStatusLabel(content.estado) | translate }}
                  </span>
                </div>
              </div>

              <div class="content-actions">
                @if (getAvailableTransitions(content.estado).length > 0) {
                  <div class="status-transitions">
                    <span class="transition-label">{{ 'admin.changeStatus' | translate }}:</span>
                    @for (newStatus of getAvailableTransitions(content.estado); track newStatus) {
                      <button
                        type="button"
                        class="btn-status"
                        [class]="'btn-' + newStatus"
                        (click)="changeStatus(content, newStatus)"
                      >
                        {{ getStatusLabel(newStatus) | translate }}
                      </button>
                    }
                  </div>
                } @else {
                  <span class="no-transitions">{{ 'admin.noTransitions' | translate }}</span>
                }
              </div>
            </article>
          }
        </div>
      }
    </section>
  </main>
</div>

